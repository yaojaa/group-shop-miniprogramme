<view class="container">
    <view class="order-title text-primary">
        <navigator url="/pages/goods/goods?goods_id={{goods_id}}" hover-class="none">
            <text class="goods_title">{{goods_name}}</text>
        </navigator>
        <view class="actionsButtons">
            <view>
                <!--    <button class=" round   mv-sm ml-sm  button-hover" size="mini" bindtap="exportExcel">一键复制收货人地址</button>
                <button class=" round   mv-sm ml-sm  button-hover" size="mini" bindtap="exportExcel">导出名单</button> -->
                <i-button bindtap="handleOpen1" size="mini" bindtap="showPopMenu">
                    <i-icon size="20" type="other" />
                </i-button>
                <i-pop-menu visible="{{ showPop }}" actions="{{ pop_name_arr }}" bind:cancel="handleCancel1" width="200rpx" left="-100rpx" top="95rpx" bind:click="handleClickItem1" />
                <!--   <button class="btn linenear_bg round   mv-sm ml-sm  button-hover" size="mini" bindtap="sendMsg">群发通知</button> -->
                <!--            <i-switch value="{{switchOrderList}}" size="large" bind:change="onChangeOrderSwitch" slot="footer">
            <view slot="open">展开</view>
            <view slot="close">收起</view>
        </i-switch> -->
            </view>
        </view>
    </view>
    <view class="tabsArea">
        <i-tabs current="{{ tab }}" color="#47b34f" bindchange="handleTab">
            <i-tab key="0" title="订单（{{valid_order.count}}）"></i-tab>
            <i-tab key="3" title="未发货（{{back_order.count}}）"></i-tab>
            <i-tab key="4" title="已发货（{{shipped_order.count}}）"></i-tab>
        </i-tabs>
    </view>
    <!--     状态 1:未支付,2:已支 付,3:待发货,4:已发货 不传默认所有
 -->
    <view class="totalCount">
        <block wx:if="{{tab == 0 && valid_order.spec }}">
            <view class="tips_title">备货统计</view>
            <view class="spec text-justify " wx:key="index" wx:for="{{valid_order.spec}}">
                <view>{{item.spec_name}}
                    <text class="text-danger">× {{item.qty}}</text>
                </view>
            </view>
        </block>
        <block wx:if="{{tab == 3 && back_order.spec.length}}">
            <view class="tips_title">未发货统计</view>
            <view class="spec text-justify" wx:key="index" wx:for="{{back_order.spec}}">
                <view>{{item.spec_name}}
                    <text class="text-danger">× {{item.qty}}</text>
                </view>
            </view>
        </block>
        <block wx:if="{{tab == 4 && shipped_order.spec.length}}">
            <view class="tips_title">已发货统计</view>
            <view class="spec text-justify" wx:key="index" wx:for="{{shipped_order.spec}}">
                <view>{{item.spec_name}}
                    <text class="text-danger">× {{item.qty}}</text></view>
            </view>
        </block>
    </view>

    <view class="text-center" wx:if="{{dataList.length==0}}">
        暂无订单
    </view>
    <view class="order-item" wx:for="{{dataList}}" wx:key="index" wx:for-index="bindex">
        <view class="order-hd">
            <view class="number">
                                <text class="create_number">{{item.create_number}}</text>

                <image class="userinfo-avatar" mode="cover" src="{{item.user.headimg}}" />
            </view>
            <view class="user-info"><text class="name"> {{item.user.nickname}}</text>
                <text class="tel" bindlongpress="calluser" data-text="{{item.user.mobile}}" data-mobile="{{item.user.mobile || item.mobile}}">{{item.user.mobile || item.mobile}}</text></view>
            <view class="order-status">
                <text class="color_{{item.order_status}}"> {{item.order_status_txt}}
                </text>
            </view>
        </view>
        <view class="order-bd">
            <view class="type text-justify  scale-b-1px" wx:for="{{item.order_detail}}" wx:key="{{index}}" wx:for-item="g">
                <view>{{g.spec_name}} ×{{g.qty}}</view>
                <view class="text-info">¥ {{g.total_price}} </view>
            </view>
            <view class="copy-address f14 scale-b-1px" wx:if="{{item.delivery_method==1}}">
                <text class="address" data-text="{{item.address+','+item.consignee+','+item.mobile+','+item.order_detail[0].qty}}" bindtap="copy">
                    收件人：{{item.consignee}} 复制
                    电话：{{item.mobile}}
                    地址：{{item.address}}
                </text>
            </view>
            <view class="remark scale-b-1px" wx:if="{{item.create_remark}}">
                <text class="text-danger" selectable="true" data-text="{{item.user_message}}" bindtap="copy" data-text="{{item.user_message}} ">
                    用户备注：{{item.user_message}}
                </text>
            </view>
            <view class="total text-justify scale-b-1px">
                <view><text class="warning-text f18">¥{{item.pay_price}} </text>
                    <text class="success-text" wx:if="{{item.pay_status==1}}">已支付</text>
                    <text class="danger-text" wx:if="{{item.pay_status==0}}">待支付（客户30分钟不支付将自动关闭）</text>
                    <text class="danger-text" wx:if="{{item.pay_status==2}}">支付失败</text>
                </view>
                <view class="text-right"> <text class="order-date">{{item._format_add_time}}</text>
                </view>
            </view>
        </view>
        <view class="order-fd scale-b-1px">
            <!--  <view class="spec_item">
                
            <text  wx:for="{{item.goods}}" wx:key="{{index}}" wx:for-item="g">
                {{g.spec_key_name}} ×{{g.goods_num}}
            </text>
            </view> -->

            <button data-avatar="{{item.user.headimg}}" data-user_name="{{item.consignee}}" class="btn round primary hollow w-min-big mv-sm ml-sm btn-{{btn.opt}}" formType="submit" data-id="{{item.order_id}}" data-opt="{{btn.opt}}" data-txt="{{btn.txt}}" bindtap="setTips">发送通知</button>



            <block wx:for="{{item.seller_next_handle}}" wx:key="{{index}}" wx:for-item="btn">
                <form bindsubmit="formSubmit" report-submit="true">
                    <button data-avatar="{{item.user.headimg}}" data-user_name="{{item.consignee}}" class="btn round primary hollow w-min-big mv-sm ml-sm btn-{{btn.opt}}" formType="submit" data-id="{{item.order_id}}" 
                    data-opt="{{btn.opt}}"
                    data-index="{{index}}"
                    data-txt="{{btn.txt}}" bindtap="orderActions">{{btn.txt}}</button>
                </form>
            </block>
        </view>
        <!--  <form bindsubmit="order_remarkSubmit" report-submit="true"> -->
        <view class="note-box">
            <i-icon type="brush" size="14" class="note-icon" />
            <view class="note-input">
                <i-input type="text" name="order_remark" value="{{item. seller_remarks}}" placeholder="备注" i-class="input-bd" data-id="{{item.order_id}}" bind:blur="order_remarkSubmit" />
            </view>
            <!-- <view class="note-submit">
                    <input type="hidden" hidden="true" name="order_id" value="{{item.order_id}}" />
                    <button shape="circle" size="mini" formType="submit" data-id="{{item.order_id}}">保存</button>
                </view> -->
        </view>
        <!-- </form> -->
    </view>

       <view class="text-center">
        <wux-spin wx:if="{{loading}}"></wux-spin>
  </view>





    <i-modal title="订单确认" visible="{{ visible1 }}" actions="{{ actionsConfirm }}" bind:click="toConfirm">
        <view>确认订单信息无误，可以接单</view>
    </i-modal>
    <i-modal title="取消订单" visible="{{ visible3 }}" actions="{{ actionsCancel }}" bind:click="toCancel">
        <view>确定要取消这个订单吗？</view>
    </i-modal>
    <i-modal title="确认发货" visible="{{ visible2 }}" bind:ok="toShipping" bind:cancel="closeShipping">
        <view class="price-input">
            已经给Ta发完货了吗？
            <!--             <input bindinput="noteInput" value="{{note}}" placeholder="备注(选填)" />
 -->
        </view>
    </i-modal>
    <i-modal title="确认已支付" visible="{{ visible4_pay }}" bind:ok="setPay" bind:cancel="closePay">
        <view class="price-input">
            请确认Ta已经线下支付过了哦
        </view>
    </i-modal>
    <i-modal title="发送微信通知" visible="{{ showMsgTips }}" bind:ok="setTips" bind:cancel="closeTips">
        <view class="input_box">
            <input bindinput="noteInput" value="{{note}}" placeholder="输入提醒内容:如请来101取货" />
            是否群发所有人：
            <switch bindchange="switchSendAll" />
        </view>
    </i-modal>
    <i-message id="message" />
</view>